import{r as t,j as s}from"./app-R8qb_GtJ.js";import{n as f}from"./index-D-dy2gg0.js";function w({gameSlug:r,playerName:p="Player",onClose:b}){const[a,i]=t.useState([]),[n,d]=t.useState(""),[c,x]=t.useState(!1),l=t.useRef(null),m=async()=>{x(!0);try{const e=await fetch(`/games/${r}/messages`);if(!e.ok)throw new Error("Failed to load chat.");const o=await e.json();i(o.messages||[])}catch(e){f.error(e.message||"Chat load failed")}finally{x(!1)}},h=async()=>{if(n.trim())try{const e=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",o=await fetch(`/games/${r}/messages`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":e,Accept:"application/json"},body:JSON.stringify({body:n.trim(),sender:p})});if(!o.ok)throw new Error("Failed to send message.");const u=await o.json();i(g=>[...g,u.message]),d(""),setTimeout(()=>l.current?.scrollIntoView({behavior:"smooth"}),50)}catch(e){f.error(e.message||"Send failed")}};return t.useEffect(()=>{m();const e=setInterval(m,5e3);return()=>clearInterval(e)},[r]),t.useEffect(()=>{l.current?.scrollIntoView({behavior:"smooth"})},[a]),s.jsxs("div",{className:"fixed bottom-4 right-4 w-full max-w-md bg-white border border-slate-200 rounded-2xl shadow-2xl flex flex-col overflow-hidden z-40",children:[s.jsxs("div",{className:"flex items-center justify-between bg-slate-50 px-4 py-3 border-b border-slate-200",children:[s.jsx("div",{className:"font-semibold text-slate-800",children:"Lobby Chat"}),s.jsx("button",{className:"text-slate-500 hover:text-slate-700",onClick:b,children:"âœ•"})]}),s.jsxs("div",{className:"h-72 overflow-y-auto px-4 py-3 space-y-2 text-left bg-white",children:[c&&a.length===0&&s.jsx("div",{className:"text-sm text-slate-500",children:"Loading chat..."}),a.length===0&&!c&&s.jsx("div",{className:"text-sm text-slate-400 text-center py-8",children:"No messages yet. Start the conversation!"}),a.map(e=>s.jsxs("div",{className:"rounded-xl bg-slate-100 px-3 py-2",children:[s.jsx("div",{className:"text-xs font-semibold text-slate-600",children:e.sender}),s.jsx("div",{className:"text-sm text-slate-800 whitespace-pre-line break-words",children:e.body})]},e.id)),s.jsx("div",{ref:l})]}),s.jsxs("div",{className:"border-t border-slate-200 p-3 bg-slate-50 flex gap-2",children:[s.jsx("input",{className:"flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:border-pink-500",placeholder:"Type a message",value:n,onChange:e=>d(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),h())}}),s.jsx("button",{className:"rounded-xl bg-pink-500 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-pink-200/70 hover:bg-pink-600",onClick:h,children:"Send"})]})]})}export{w as C};
