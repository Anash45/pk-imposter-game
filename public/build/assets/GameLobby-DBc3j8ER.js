import{r as l,j as e,H as G}from"./app-R8qb_GtJ.js";import{F as L,n as c}from"./index-D-dy2gg0.js";import{C as T}from"./Chat-CeomPNd3.js";const v=["bg-gradient-to-br from-cyan-400 to-cyan-600 text-slate-900","bg-gradient-to-br from-emerald-500 to-teal-400 text-white","bg-gradient-to-br from-indigo-600 to-blue-400 text-white","bg-gradient-to-br from-amber-400 to-orange-500 text-slate-900","bg-gradient-to-br from-rose-500 to-pink-400 text-white","bg-gradient-to-br from-slate-800 to-slate-600 text-white","bg-gradient-to-br from-lime-400 to-green-500 text-slate-900","bg-gradient-to-br from-purple-600 to-fuchsia-400 text-white"],A=a=>{let s=0;for(let n=0;n<a.length;n+=1)s=(s<<5)-s+a.charCodeAt(n),s|=0;return s};function D({gameSlug:a,players:s=[],voiceUrl:n}){const[i,h]=l.useState(null),[o,b]=l.useState(null),[j,u]=l.useState(!1),[N,k]=l.useState(s),[C,f]=l.useState(!1),[g,S]=l.useState(()=>localStorage.getItem(`lobby-player-${a}`)||null),d=g,R=async t=>{if(d&&d!==t.name){c.error("You can only view your own card.");return}if(t.hasViewed){c.error("This card has already been revealed.");return}u(!0);try{const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",p=await fetch(`/games/${a}/reveal/${t.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":r,Accept:"application/json"}});if(!p.ok)throw new Error("Failed to reveal card.");const y=await p.json();if(y.alreadyViewed){c.error("This card has already been revealed.");return}h(t),b(y),localStorage.setItem(`lobby-player-${a}`,t.name),S(t.name),k(V=>V.map(x=>x.id===t.id?{...x,hasViewed:!0}:x))}catch(r){c.error(r.message||"Something went wrong.")}finally{u(!1)}},w=()=>{h(null),b(null)},P=i?v[Math.abs(A(i.name||""))%v.length]:"",m=o?o.alreadyViewed?{title:"Card already revealed",body:"This card was already viewed."}:o.isImposter?{title:"You are the Imposter!",body:"Bluff your way through the round."}:{title:"Your Secret Word",body:o.word}:null;return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsx("title",{children:"Game Lobby - Pakistani Imposter Game"})}),e.jsx(L,{position:"top-center"}),e.jsx("div",{className:"min-h-screen w-full bg-gradient-to-br from-slate-100 to-slate-200 flex flex-col items-center px-4 py-10",children:e.jsxs("div",{className:"w-full max-w-4xl bg-white rounded-3xl p-8 shadow-2xl text-center",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Game Lobby"}),e.jsx("p",{className:"text-slate-600",children:"Click your name to reveal your card. Keep it secret!"})]}),e.jsxs("button",{className:"self-start inline-flex items-center gap-2 rounded-full bg-slate-100 px-4 py-2 text-slate-700 border border-slate-200 hover:bg-slate-200",onClick:()=>f(t=>!t),children:[e.jsx("span",{children:"ðŸ’¬"}),e.jsx("span",{className:"font-semibold",children:"Chat"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 my-8",children:N.map(t=>{const r=d&&d!==t.name;return e.jsxs("button",{onClick:()=>R(t),disabled:t.hasViewed||j||r,className:`rounded-2xl border-2 px-6 py-8 text-lg font-semibold transition shadow-sm ${t.hasViewed?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":r?"bg-slate-50 text-slate-300 border-slate-200 cursor-not-allowed":"bg-gradient-to-br from-pink-400 to-rose-400 text-white border-pink-500 hover:shadow-lg hover:-translate-y-1 cursor-pointer"}`,children:[t.name,t.hasViewed&&e.jsx("div",{className:"text-sm mt-1 font-normal",children:"Already revealed"}),r&&!t.hasViewed&&e.jsx("div",{className:"text-xs mt-1 opacity-70",children:"Locked"})]},t.id)})}),i&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:w,children:e.jsxs("div",{className:"bg-white rounded-3xl p-8 max-w-lg w-full shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:["Hi, ",i.name]}),e.jsx("div",{className:"relative w-full h-72 mx-auto my-6 [perspective:1100px] select-none",children:e.jsxs("div",{className:`relative w-full h-full rounded-3xl shadow-2xl flex flex-col items-center justify-center px-6 text-center ${P}`,children:[e.jsx("div",{className:"text-2xl font-bold mb-3",children:m.title}),e.jsx("div",{className:"text-lg whitespace-pre-line",children:m.body})]})}),e.jsx("div",{className:"text-sm text-slate-500 mb-4",children:!o.alreadyViewed&&"Remember your card! You can't view it again."}),e.jsx("button",{className:"w-full rounded-xl bg-pink-500 px-6 py-3 text-white font-semibold shadow-md hover:bg-pink-600",onClick:w,children:"Close"})]})}),C&&e.jsx(T,{gameSlug:a,playerName:g||"Guest",onClose:()=>f(!1)}),e.jsx("div",{className:"text-sm text-slate-500 mt-8",children:"Share this page's URL with all players to let them reveal their cards."})]})})]})}export{D as default};
